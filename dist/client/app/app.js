!function(){"use strict";angular.module("Recipes",["ui.router","Postman","angular-jwt","angular-stripe"]).config(["$stateProvider","$urlRouterProvider","$locationProvider",function(e,t,n){t.otherwise("/login"),n.html5Mode(!0),e.state("recipes",{url:"/recipes",templateUrl:"/app/partials/recipes.html",controller:"RecipesCtrl",onEnter:["$rootScope","$state",function(e,t){e.user&&e.user.delinquent!==!0||t.go("login")}]}).state("menu",{url:"/menu",templateUrl:"/app/partials/menu.html",controller:"MenuCtrl",onEnter:["$rootScope","$state","Auth",function(e,t,n){e.user&&e.user.delinquent!==!0||t.go("home")}]}).state("shopping",{url:"/shopping",templateUrl:"/app/partials/shopping.html",controller:"ShoppingCtrl",onEnter:["$rootScope","$state","Auth",function(e,t,n){e.user&&e.user.delinquent!==!0||t.go("home")}]}).state("home",{url:"/",templateUrl:"/app/partials/home.html",controller:"AuthCtrl"}).state("login",{url:"/login",templateUrl:"/app/partials/auth/login.html",controller:"AuthCtrl",onEnter:["$rootScope","$state","Auth",function(e,t,n){e.user&&e.user.delinquent===!1&&t.go("recipes")}]}).state("signup",{"abstract":!0,templateUrl:"/app/partials/auth/signup.html",controller:"AuthCtrl",onEnter:["$rootScope","$state","Auth",function(e,t,n){e.user&&e.user.delinquent===!1&&t.go("recipes")}]}).state("signup.account",{url:"/signup",templateUrl:"/app/partials/auth/accountForm.html"}).state("signup.plans",{url:"/plans",templateUrl:"/app/partials/auth/plansForm.html"}).state("signup.success",{url:"/signup-success",templateUrl:"/app/partials/auth/signupSuccess.html"})}]).config(["stripeProvider",function(e){e.setPublishableKey("pk_test_JtilbhkH1q5rq1RxyT6TA27R")}]).run(["$state","$rootScope","jwtHelper","$location","$window","Auth",function(e,t,n,o,r,i){t.$on("$stateChangeSuccess",function(e){r.ga&&r.ga("send","pageview",{page:o.path()})});var u=i.getToken();if(u&&!i.isTokenExpired()){var c=n.decodeToken(u);t.user=c,e.go("recipes")}else e.go("login");t.logout=function(){i.logout().then(function(){e.go("login")},function(e){console.log(e)})}}])}(),function(){"use strict";angular.module("Recipes").factory("Auth",["$q","$http","$window","$rootScope","jwtHelper",function(e,t,n,o,r){return{login:function(o){var r=e.defer();return t.post("/api/login",o).success(function(e){n.localStorage.jwt=e,r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},signup:function(o){var r=e.defer();return t.post("/api/signup",o).success(function(e){n.localStorage.jwt=e,r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},logout:function(){var r=e.defer();return t.post("/api/logout").success(function(){o.user=null,n.localStorage.clear("jwt"),r.resolve(!0)}).error(function(e){r.reject(e)}),r.promise},getToken:function(){return n.localStorage.jwt},isTokenExpired:function(){return r.isTokenExpired(n.localStorage.jwt)}}}])}(),function(){"use strict";angular.module("Recipes").factory("StripeSrvc",["$q","$http","stripe",function(e,t,n){return{getPlans:function(){var n=e.defer();return t.get("/api/stripe/plans").success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise}}}])}(),function(){"use strict";angular.module("Recipes").factory("Recipe",["$http","$q","$rootScope",function(e,t,n){return{getRecipes:function(){var n=t.defer();return e.get("/api/recipes").success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise},addNewRecipe:function(n,o){var r=t.defer();return e.post("/api/recipes",{recipe:n,ingredients:o}).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},addToMenu:function(n){var o=t.defer();return e.put("/api/recipes/menu",n).success(function(e){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise},removeRecipe:function(n){var o=t.defer();return e["delete"]("/api/recipes/"+n._id).success(function(){o.resolve(!0)}).error(function(e){o.reject(e)}),o.promise}}}])}(),function(){"use strict";angular.module("Recipes").factory("Menu",["$q","$http",function(e,t){return{getMenu:function(){var n=e.defer();return t.get("/api/recipes/menu").success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise},removeFromMenu:function(n){var o=e.defer();return t.put("/api/recipes/menu/remove",n).success(function(e){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise}}}])}(),function(){"use strict";angular.module("Recipes").factory("Shopping",["$q","$http",function(e,t){return{getShoppingList:function(){var n=e.defer();return t.get("/api/recipes/shopping").success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise},buyItem:function(n){var o=e.defer();return t.put("/api/recipes/item",n).success(function(e){o.resolve(e)}).error(function(e){o.rejet(e)}),o.promise}}}])}(),function(){"use strict";angular.module("Recipes").controller("AuthCtrl",["$scope","$rootScope","$window","$state","jwtHelper","Auth","StripeSrvc",function(e,t,n,o,r,i,u){e.title="Welcome",e.formData={},u.getPlans().then(function(t){e.plans=t},function(e){console.log(e)}),e.rememberMe=!1,e.login=function(n){i.login(n).then(function(){var e=i.getToken(),n=r.decodeToken(e);t.user=n,o.go("recipes")},function(t){e.loginError=t})},e.signup=function(t){e.formData=t,o.go("signup.plans")},e.choosePlan=function(t){e.formData.plan=t,o.go("signup.success")},e.checkRemember=function(){e.rememberMe=!e.rememberMe}}])}(),function(){"use strict";angular.module("Recipes").controller("RecipesCtrl",["$scope","Recipe","Menu","Shopping",function(e,t,n,o){e.title="Recipes",e.newForm=!1,t.getRecipes().then(function(t){e.recipes=t}),e.ingredients=[1],e.newRecipe=function(){e.newForm=!e.newForm},e.addIngredient=function(){var t=e.ingredients.length+1;e.ingredients.push(t)},e.addRecipe=function(n){var o={title:n.title,description:n.description};t.addNewRecipe(o,n.ingredients).then(function(t){e.recipes.push(t),e.newRec="",e.newForm=!1},function(e){console.log(e)})},e.removeRecipe=function(n,o){t.removeRecipe(n).then(function(){e.recipes.splice(o,1)},function(e){alert(e)})},e.removeIngredient=function(t){e.ingredients.splice(t,1)},e.addToMenu=function(e,n){t.addToMenu(e).then(function(){e.inMenu=!0},function(e){console.log(e)})},e.removeMenu=function(e,t){n.removeFromMenu(e).then(function(){e.inMenu=!1},function(e){console.log(e)})}}])}(),function(){"use strict";angular.module("Recipes").controller("MenuCtrl",["$scope","Menu",function(e,t){e.title="Menu",t.getMenu().then(function(t){e.menu=t},function(e){console.log(e)})}])}(),function(){"use strict";angular.module("Recipes").controller("ShoppingCtrl",["$scope","Shopping",function(e,t){e.title="Shopping List",t.getShoppingList().then(function(t){e.list=t},function(e){console.log(e)}),e.buyItem=function(e,n){t.buyItem(e,n).then(function(){e.bought=!e.bought},function(e){console.log(e)})}}])}();