var Recipe=require("../models/recipes"),Ingredient=require("../models/ingredients"),jwt=require("jwt-simple"),config=require("../config"),_=require("lodash");exports.index=function(e,s){var n=e.session.user;Recipe.find({user:n}).populate("ingredients").exec(function(e,n){e?s.status(500).json(e):s.status(201).json(n)})},exports.create=function(e,s){var n=e.body.recipe,i=e.body.ingredients;n.user=e.session.user;var t,r=new Recipe(n);_.forEach(i,function(e,n){e._recipe=r._id,t=new Ingredient(e),r.ingredients.push(t._id),t.save(function(e){e&&(console.log(e),s.status(500).json(e))})}),r.save(function(e,t){e?s.status(500).json(e):(n.ingredients=i,n._id=t._id,s.status(201).json(n))})},exports.destroy=function(e,s){var n=e.params.id;Recipe.findOneAndRemove({_id:n},function(e,n){e?s.status(500).json(e):s.status(200).json(n)})};